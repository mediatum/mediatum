<!--
  Copyright (C) since 2007, Technical University of Munich (TUM) and mediaTUM authors
  SPDX-License-Identifier: AGPL-3.0-or-later
-->
<tal:block metal:define-macro="edit_search">
    <style>
        #sub_content_content{padding:0!important}
    </style>

    <script tal:content="python:'var id = %r;' % str(id)"> </script>
    <script src="/js/edit/modules/searchmask.js"> </script>
    <div id="sub_content_content">
        <form class="edit" action="edit_content" name="changeform" id="fbody">
            <input tal:attributes="value csrf" type="hidden" name="csrf_token">
            <span i18n:translate="edit_searchmask_type">TEXT</span>:
            <input type="image" name="update" value="update" src="/img/s.gif">
                <select id="searchtype_id" name="searchtype" onChange="change_searchtype()">
                <option tal:attributes="selected python:[None,'selected'][searchtype=='none']" value="none" i18n:translate="edit_searchmask_none">TEXT</option>
                <option tal:attributes="selected python:[None,'selected'][searchtype=='parent']" value="parent" i18n:translate="edit_searchmask_parent">TEXT</option>
                <option tal:attributes="selected python:[None,'selected'][searchtype=='own']" value="own" i18n:translate="edit_searchmask_new">TEXT</option>
            </select>
            <div style="padding:20px">
                <input type="hidden" name="tab" value="searchmask"/>
                <input tal:condition="python:selectedfield" type="hidden" name="selectedfield" tal:attributes="value python:selectedfield.id"/>
                <input tal:attributes="value idstr" type="hidden" name="id"/>
                <div metal:use-macro="field_details" id="field_details"></div>
                <input type="hidden" name="isnewfield" id="isnewfield" value=""/>
            </div>
        </form>
    </div>
    <div id="sub_footer_module"> </div>
</tal:block>

<tal:block metal:define-macro="field_details">
    <table tal:condition="python:searchtype=='own'">
        <tal:block tal:repeat="field searchfields">
            <tal:block tal:condition="python:field!=selectedfield">
                <tr>
                    <td valign="center">
                        <a href="#" tal:attributes="onclick python:'open_field(\''+ustr(field.id)+'\')'; name python:'open_'+ustr(field.id)" ><img src="/img/boxx.gif"></a>
                    </td>
                    <td valign="center" colspan="2">
                        <tal:block tal:content="python:field.name"/>
                        <tal:block tal:condition="python:field.children.count()">
                        (<tal:block tal:repeat="f python:field.children.limit(10).all()">
                            <tal:block tal:condition="python:f.type == 'metafield'">
                                <tal:block tal:define="fschema python:f.parents.filter_by(type='metadatatype').first()">
                                <tal:block tal:content="python:fschema and fschema.name or '???'"/>:<tal:block tal:content="python:f.name"/>
                                </tal:block>
                            </tal:block>
                        </tal:block>
                        <tal:block tal:condition="python:field.children.count()>10">...</tal:block>)
                        </tal:block>
                    </td>
                </tr>
            </tal:block>
            <tal:block metal:define-macro="field_table" tal:condition="python:field==selectedfield">
                <tr>
                    <td valign="top">
                        <input type="image" name="close" value="close" tal:attributes="onclick python:'close_field(\''+ustr(field.id)+'\')'" src="/img/box.gif"/>
                    </td>
                    <td colspan="2">
                        <table frame="box">
                            <tr>
                                <td colspan="2">
                                    <input type="text" name="fieldname" id="fnid" tal:attributes="value python:field.name"/>
                                </td>
                                <td colspan="1">
                                    <input type="image" tal:attributes="onclick python:'delete_field(\''+ustr(field.id)+'\')'; name python:'del_'+ustr(field.id)" src="/img/delete.png"/>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td colspan="3"><b i18n:translate="edit_searchmask_fieldtitle"></b></td>
                            </tr>
                            <tr>
                                <td colspan="3">&nbsp;</td>
                            </tr>
                            <tr tal:condition="python: not field.children.count()">
                                <td colspan="3" i18n:translate="edit_searchfield_none">TEXT</td>
                            </tr>
                            <tr tal:condition="python:field.children.count()">
                                <td><b i18n:translate="edit_searchmask_schema"></b></td>
                                <td><b i18n:translate="edit_searchmask_field"></b></td>
                                <td>&nbsp;</td>
                            </tr>
                            <tal:block tal:condition="python:field.children.count()" tal:repeat="subfield python:field.children">
                            <tr tal:condition="python:subfield.type == 'metafield'">
                                <tal:block tal:define="ss python:subfield.parents.filter_by(type='metadatatype').first()">
                                    <td tal:content="python:ss and ss.name or '??'"/>
                                </tal:block>
                                <td tal:content="python:subfield.name"/>
                                <td><input type="image" tal:attributes="onclick python:'delete_subfield(\''+ustr(subfield.id)+'\', \''+ustr(field.id)+'\')'; name python:'delsub_'+ustr(subfield.id)" src="/img/delete.png"/></td>
                            </tr>
                            </tal:block>
                            <tr>
                                <td colspan="3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td>
                                    <select name="schema" id="ssel" tal:attributes="onchange python:'select_schema(\''+ustr(field.id)+'\')'">
                                        <option value=""></option>
                                        <tal:block tal:repeat="schema schemas">
                                            <option tal:attributes="value python:schema.id; selected python:[None,'selected'][schema.id==defaultschemaid]" tal:content="python:schema.name"></option>
                                        </tal:block>
                                    </select>
                                </td>
                                <td>
                                    <select name="schemafield" id="sfsel">
                                        <tal:block tal:condition="schema" tal:repeat="schemafield python:schema.children">
                                        <option tal:condition="python:display(schemafield)"
                                            tal:attributes="value python:schemafield.id; selected python:[None,'selected'][schemafield.id==defaultfieldid]"
                                            tal:content="python:schemafield.name"></option>
                                        </tal:block>
                                    </select>
                                </td>
                                <td>
                                    <input type="image"  name="createsub" tal:attributes="onclick python:'create_subfield(\''+ustr(field.id)+'\')'" src="/img/haken.gif">
                                </td>
                            </tr>
                        </table>
                        <br/>
                    </td>
                </tr>
            </tal:block>
        </tal:block>
        <tr>
            <td valign="center">
                <input type="image" name="newfield" value="newfield" onClick="create_field()" src="/img/box3.gif"/>
            </td>
            <td valign="center" colspan="2">
                <a href="#" onClick="create_field()" ><span style="cursor:pointer;color:#0a5096;" i18n:translate="edit_searchmask_add"/></a>
            </td>
        </tr>
    </table>
</tal:block>
