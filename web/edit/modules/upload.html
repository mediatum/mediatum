<tal:block metal:define-macro="upload_form">

    <script type="text/javascript" src="/js/plupload/plupload.full.min.js"> </script>
    <script type="text/javascript" src="/js/jquery.ui.plupload/jquery.ui.plupload.js"> </script>

    <!-- activate translation for plupload -->
   <script type="text/javascript" tal:attributes="src python:u'/js/plupload/i18n/{}.js'.format(language)"> </script>

<link rel="stylesheet" href="/js/jquery-ui-1.12.1.css" type="text/css" />
<link rel="stylesheet" href="/js/jquery.ui.plupload/css/jquery.ui.plupload.css" type="text/css" />
    <script tal:content="python:u'var id = \'{}\';'.format(id)"> </script>
    <script tal:content="python:u'var sid = \'{}\';'.format(sid)"> </script>


    <script type="text/javascript">


        function openMetaForm(){

            var ajax_response;

            var options = {
                  url: '/edit/edit_content?action=addmeta&func=openMetaForm&id='+id,
                  async: false,
                  dataType: 'json',
                  success: function(data){
                      ajax_response = data;
                      $('#metaformcontent').html(data.content);
                      $('#metaform').show();
                  }
                };

            $.ajax(options);
            parent.$('#overlay').css('display', 'block');
        }


        function closeMetaForm(){ // close upload form
            $('#metaform').hide();
            parent.$('#overlay').css('display', 'none');
        }

        function openDoiForm(){

            var ajax_response;

            var options = {
                  url: '/edit/edit_content?action=adddoi&func=openMetaForm&id='+id,
                  async: false,
                  dataType: 'json',
                  success: function(data){
                      ajax_response = data;
                      $('#metaformcontent').html(data.content);
                      $('#metaform').show();
                  }
                };

            $.ajax(options);
            parent.$('#overlay').css('display', 'block');
        }


        function closeDoiForm(){ // close upload form
            $('#metaform').hide();
            parent.$('#overlay').css('display', 'none');
        }


        var number_files = 0;
        var singlefile = 0;

        function loadEditArea02(id){
            $('.ui-layout-center').attr('src', '/edit/edit_content?id='+id);
        }


    </script>


<div id="navigation_content" style="border:1px solid silver!important;border-width:0px 0px 1px 1px !important;">

    <div style="padding-left:30px;clear:left">

        <tal:block tal:condition="python:len(schemes)>=1 and len(datatypes)>=1">
            <a class="uploadmeta" href="#" onclick="openMetaForm()"><img src="/img/upload.png"/> <tal:block i18n:translate="edit_upload_meta"/></a>
        </tal:block>

        <a class="uploaddoi" href="#" onclick="openDoiForm()"><img src="/img/upload.png"/> <tal:block i18n:translate="edit_upload_doi"/></a>

        <a class="uploadfile" id="id_a_openplupload" href="#" onclick="openUploadFormPluploadWidget()"> <img src="/img/upload.png"/> <tal:block i18n:translate="edit_upload_files_plupload_widget"/></a>

        <a class="uploadbibtex" id="id_a_openplupload" href="#" onclick="openUploadFormPluploadWidget()"><img src="/img/upload.png"/> <tal:block i18n:translate="edit_upload_bibtex_plupload_widget"/></a>

    </div>


<div style="clear:right"> </div>
        <div id="search" style="float:right;width:390;border:1px solid silver" tal:content="raw search">TEXT</div>

<div style="clear:left"> </div>

        <div id="nav" style="float:left;clear:both" tal:content="raw nav">TEXT</div>

    </div>

<div style="clear:right"> </div>

    <div id="sub_footer_module" style="overflow:hidden!important;border-width:0px!important;height:20xp;padding:0px!important;">
        <div style="position:absolute;right:5px;top:2px;font-size:11px">
            <tal:block tal:replace="count"/> item(s)
        </div>
    </div>


    <div id="sub_content_content">
        <div id="nodelist" tal:content="raw nodelist">TEXT</div>
    </div>

    <div id="mediatum_uploadform_plupload_widget_file">
        <div class="mediatum_pluploadform-background">&nbsp;</div>
        <div id="uploadform-form">
            <div style="position:absolute;top:-7px;right:-7px;z-index:10002"><a href="#" onclick="closeFormPluploadWidget()" i18n:attributes="title mask_editor_cancel"><img src="/img/cancel.png"/></a></div>
              <form tal:condition="python:len(schemes)!=0"  style="border:2px solid silver;">

              	<div id="uploader" style="width:100%;height:450px;">
              		<p>Your browser doesn't have Flash, Silverlight or HTML5 support.</p>
              	</div>
              	<br />
              	<button id="id_button_createobjectsplupload" type="button" disabled onclick="createObjectsPlupload();" i18n:translate="edit_upload_create_objects">TEXT</button><span id="span_plupload_createobjects" > </span>
              </form>
              <form tal:condition="python:len(schemes)==0"  style="border:1px solid silver;">

              	<div>
              		<p>you cannot upload because you have no metadata types defined</p>
              	</div>
              	<br />
              </form>
        </div>
    </div>

<script tal:content="python:u'var uploadstate = \'{}\';'.format(uploadstate)"> </script>
<script tal:content="python:u'var js_upload_unpack = \'{}\';'.format(t(language, 'edit_upload_unpack'))">;</script>
<script tal:content="python:u'var js_upload_no_unpack = \'{}\';'.format(t(language, 'edit_upload_no_unpack'))">;</script>
<script tal:content="python:u'var csrf = \'{}\';'.format(csrf)"> </script>

<script type="text/javascript">


   var uploader = null;

        function openUploadFormPluploadWidget(){ // show upload form

            var ajax_response;

            var options = {
                  url: '/edit/edit_content?action=removefiles&func=openUploadFormPluploadWidget&id='+id,
                  async: false,
                  dataType: 'json',
                  success: function(data) {
                      ajax_response = data;
                      if (data.state=='error'){
                          console.log('upload.html: openUploadFormPluploadWidget: error removing files');
                      }
                      else {
                          console.log('upload.html: openUploadFormPluploadWidget:' + JSON.stringify(data));
                      }
                  }
                };

            $.ajax(options);

            uploader = init_plupload_widget();


            uf = $('#uploadform_plupload_widget');
            uf.show();

            //hc = $('div.plupload_header_content');
            hc = $('div.plupload_header');
            ufs = $('#uploader_filelist');

                var x = $('#uploader_dropbox');
                x.css('height', '375px');
                x.css('margin-bottom', '50px');

             var uc = $('#uploader_container');
                uc.css('height', '450px');
                uc.css('margin-bottom', '50px');

            hc.remove();

            parent.$('#overlay').css('display', 'block');

        }

        function closeFormPluploadWidget() { // close upload form
            //$('#uploadform_plupload_widget').hide();
            parent.$('#overlay').css('display', 'none');

            // make sure, the plupload widget is reinitialized
            return reloadPage(id);
        }



        function createObjectsPlupload(){ // build object out of files

            console.group('edit.modules: upload.html createObjectsPlupload');

            $('#uploader_start').attr('aria-disabled','true');  // not functional ?

            number_files = $('#uploader_filelist').children().length;
            if (number_files==1){
                singlefile==1;
            }

            console.log('number_files: ' + number_files);

            var new_elem = $('<img height="30" src="/img/wait.gif" />');
            new_elem.insertBefore('#span_plupload_createobjects');
            new_elem.insertBefore('.plupload_logo');
            $('.plupload_logo').attr('class', '');
            //$('.plupload_logo').innerHTML = '<img height="30" src="/img/wait.gif" />';

            var htree = parent.gethometree();

            $.each($(".typesel"), function(i, l){
                x = $(l);
                value = x.val(); // value
                type = x.attr('id'); // type
                files = x.parents().children('#'+x.attr('id')+':last').val(); //files

                console.log('upload.createObjects: l:'+l+', value:'+value+', type:'+type+', files:'+files);

                var ajax_response;

                var options = {
                      url: '/edit/edit_content?action=buildnode&func=createObjectsPlupload&id='+id+'&files='+encodeURIComponent(files)+'&type='+type+'&value='+value,
                      async: false,
                      dataType: 'json',
                      success: function (data) {
                          ajax_response = data;
                          console.log('createObjects');
                          if (data.errornodes.length>0){
                              $('#uploader_filelist').children().first().removeClass('blue');
                              $('#uploader_filelist').children().first().addClass('red');
                          }else{
                              number_files -= 1;

                              $('#uploader_filelist').children().first().remove();

                              $('#divStatus').html('processing / ' + number_files);
                              data.new_tree_labels.forEach(
                                function(nentry) {
                                  console.log('tree_node: '+nentry.id+', new label: '+nentry.label);
                                  changed_node = htree.getNodeByKey(nentry.id);
                                  changed_node.title = nentry.label;
                                  changed_node.renderTitle();
                                }
                              )
                          }


                           console.log('$.ajax returns: '+data);
                           console.log('number_files: ' + number_files);
                    }, // success function
                   }; // options

               $.ajax(options);

                var childnode = ajax_response;

            }) // $.each
            console.log('going to call closeForm()');
            closeFormPluploadWidget();
            console.log('after called: closeForm()');
            console.log('going to call loadEditArea(id), id:'+id);
            parent.loadEditArea(id);
            console.log('after called loadEditArea(id), id:'+id);
            console.groupEnd('edit.modules: upload.html createObjectsPlupload');
            parent.$('#overlay').css('display', 'none');  // removing overlay from tree
        }  // function createObjectsPlupload


    var files_uploaded = 0;

    function init_plupload_widget() {
     csrf = csrf.replace("##", "!!!!!");
     var u = $(function() {

    	$("#uploader").plupload({
    		// General settings

        runtimes : 'html5,flash,silverlight,html4',
        //runtimes : 'html4',

        //autostart: true,
        autostart: false,

    		url : '/edit/edit_content?action=upload&func=init_plupload_widget&uploader=plupload&id='+id+'&csrf_token='+csrf,

    		// User can upload no more then 20 files in one go (sets multiple_queues to false)
    		max_file_count: 0,  // default is 0 -> no limit



    //multipart_params : mpv,

    		filters : {
    			// Maximum file size
    			//max_file_size : '1000mb',
    			// Specify what files to browse for
    			mime_types: [
      			{title : "Image files", extensions : "jpg,jpeg,gif,png,tif,tiff,svg,bmp"},
      			{title : "Zip files", extensions : "zip"},
                {title : "pdf files", extensions : "pdf"},
                {title: "mp4 video files", extensions : "mp4"},
                {title : "mp3 files", extensions : "mp3"},
                {title : "bibtex files", extensions : "bib"}
    			]
    		},

    		// Rename files by clicking on their titles
    		rename: true,

    		// Sort files
    		sortable: false,

    		// Enable ability to drag'n'drop files onto the widget (currently only HTML5 supports that)
    		dragdrop: true,

    		// Views to activate
    		views: {
    			list: true,
    			thumbs: false, // deactivate thumbs view
    			active: 'list'
    		},

    		// buttons to activate
    		buttons: {
    			browse: true,
    			start: true,
    			stop: true
    		},

    		// Flash settings
    	  flash_swf_url : '/js/plupload/Moxie.swf',

    		// Silverlight settings
    	  silverlight_xap_url : '/js/plupload/Moxie.xap',

            // PreInit events, bound before any internal events
            preinit : {
                Init: function(up, info) {
                    log('[Init]', 'Info:', info, 'Features:', up.features);
                },

                UploadFile: function(up, file) {
                    log('[UploadFile]', file);

                    // You can override settings before the file is uploaded
                    // up.setOption('url', 'upload.php?id=' + file.id);
                    // up.setOption('multipart_params', {param1 : 'value1', param2 : 'value2'});
                }
            },

            // Post init events, bound after the internal events
            init : {
                PostInit: function(up) {
                    // Called after initialization is finished and internal event handlers bound
                    log('[PostInit]');
                    files_uploaded = 0;

                },

                Browse: function(up) {
                    // Called when file picker is clicked
                    log('[Browse]');
                },

                Refresh: function(up) {
                    // Called when the position or dimensions of the picker change
                    log('[Refresh]');
                },

                StateChanged: function(up) {
                    // Called when the state of the queue is changed
                    log('[StateChanged]', up.state == plupload.STARTED ? "STARTED" : "STOPPED");
                },

                QueueChanged: function(up) {
                    // Called when queue is changed by adding or removing files
                    log('[QueueChanged]');
                },

                OptionChanged: function(up, name, value, oldValue) {
                    // Called when one of the configuration options is changed
                    log('[OptionChanged]', 'Option Name: ', name, 'Value: ', value, 'Old Value: ', oldValue);
                },

                BeforeUpload: function(up, file) {
                    // Called right before the upload for a given file starts, can be used to cancel it if required
                    log('[BeforeUpload]', 'File: ', file);


                                var iframe_c = $("iframe.ui-layout-center");
            var fid = file.id;
            console.log('fid='+fid);
            var filelist_line = $("#"+fid);


            var c1 = filelist_line.children()[1];

    // sending additional parameters
    this.settings.multipart_params = {
        "file_name" : file.name,
        "data_extra" : $('#select_extra_' + fid).val()
    };

                },

                UploadProgress: function(up, file) {
                    // Called while file is being uploaded
                    log('[UploadProgress]', 'File:', file, "Total:", up.total);
                },

                FileFiltered: function(up, file) {
                    // Called when file successfully files all the filters
                    log('[FileFiltered]', 'File:', file);
                },

                FilesAdded: function(up, files) {
                    // Called when files are added to queue
                    log('[FilesAdded]');

                    plupload.each(files, function(file) {
                        log('  File:', file);
                        //file.x = '777';



        var iframe_c = $("iframe.ui-layout-center");
        var fid = file.id;
        console.log('fid='+fid);
        var filelist_line = $("#"+fid);
        console.log('filelist_line', filelist_line);

        filelist_line.attr('class', 'progressContainer green');

        var c1 = filelist_line.children()[1];

        filename = file.name;
        file_ext = filename.split('.').pop().toLowerCase();

        var sel = '';

        if (file_ext == 'zip') {

          var sel = " <select name='tofiletype' class='select_unpack' id='select_extra_" + fid + "'>" +
              "<option value='tofile' selected>" + js_upload_no_unpack + "</option>" +
              "<option value='totype'>" + js_upload_unpack + "</option>" +
          "</select>";

        }
        else if (file_ext == 'bib') {

          var sel = " <select name='tofiletype' class='select_unpack' id='select_extra_" + fid + "'>" +
              "<option value='tofile'>" + js_upload_no_unpack + "</option>" +
              "<option value='totype' selected>" + js_upload_unpack + "</option>" +
          "</select>";

        }
        else {
        /*
          var sel = "<select name='tofiletype' id='select_extra_" + fid + "'>" +
              "<option value='tofile'>To File (no unzip)</option>" +
              "<option value='totype' selected>To typed nodes (unzip)</option>" +
          "</select>";
        */

        }

          c1.innerHTML = c1.innerHTML + sel;

            c1ppp = c1.parentNode.parentNode.parentNode;
            c1ppp.style.position = 'relative';
            c1ppp.style.top = '0px';
            c1ppp.style.overflow = 'auto';

                    });
                },

                FilesRemoved: function(up, files) {
                    // Called when files are removed from queue
                    log('[FilesRemoved]');

                    plupload.each(files, function(file) {
                        log('  File:', file);
                    });
                },

                FileUploaded: function(up, file, info) {
                    // Called when file has finished uploading
                    log('[FileUploaded] File:', file, "Info:", info);

            var iframe_c = $("iframe.ui-layout-center");
            var fid = file.id;
            console.log('fid='+fid);
            var filelist_line = $("#"+fid);
            console.log('filelist_line', filelist_line);

            filelist_line.attr('class', 'progressContainer blue');

            var c1 = filelist_line.children()[1];

            c1.innerHTML = c1.innerHTML + JSON.parse(info.response).ret;

            c1ppp = c1.parentNode.parentNode.parentNode;
            c1ppp.style.position = 'relative';
            c1ppp.style.top = '0px';
            c1ppp.style.overflow = 'auto';

            $('#select_extra_' + fid).hide();


                    htree = parent.gethometree();
                    JSON.parse(info.response).new_tree_labels.forEach(
                      function(nentry) {
                        console.log('tree_node: '+nentry.id+', new label: '+nentry.label);
                        changed_node = htree.getNodeByKey(nentry.id);
                        changed_node.data.title = nentry.label;
                        changed_node.render();
                      }
                    );

                 uc = $('#uploader_container');
                 x = uc.find('.ui-resizable-handle');
                 x.remove();

                 files_uploaded = files_uploaded + 1;

                 //debugger;
                },

                ChunkUploaded: function(up, file, info) {
                    // Called when file chunk has finished uploading
                    log('[ChunkUploaded] File:', file, "Info:", info);
                },

                UploadComplete: function(up, files) {
                    // Called when all files are either uploaded or failed
                    log('[UploadComplete]');

                    if (files_uploaded > 0) {
                        $('#id_button_createobjectsplupload').prop('disabled', false);
                    }

                },

                Destroy: function(up) {
                    // Called when uploader is destroyed
                    log('[Destroy] ');
                },

                Error: function(up, args) {
                    // Called when error occurs
                    log('[Error] ', args);
                    alert(args.message + ': ' + args.file.name);
                }
            }
        });
      });
      return u;
    }




    function log() {
        var str = "";

        plupload.each(arguments, function(arg) {
            var row = "";

            if (typeof(arg) != "string") {
                plupload.each(arg, function(value, key) {
                    // Convert items in File objects to human readable form
                    if (arg instanceof plupload.File) {
                        // Convert status to human readable
                        switch (value) {
                            case plupload.QUEUED:
                                value = 'QUEUED';
                                break;

                            case plupload.UPLOADING:
                                value = 'UPLOADING';
                                break;

                            case plupload.FAILED:
                                value = 'FAILED';
                                break;

                            case plupload.DONE:
                                value = 'DONE';
                                break;
                        }
                    }

                    if (typeof(value) != "function") {
                        row += (row ? ', ' : '') + key + '=' + value;
                    }
                });

                str += row + " ";
            } else {
                str += arg + " ";
            }
        });

        console.log(str);
    };


	// Handle the case when form was submitted before uploading has finished
	$('#form').submit(function(e) {
		// Files in queue upload them first
		if ($('#uploader').plupload('getFiles').length > 0) {

			// When all files are uploaded submit form
			$('#uploader').on('complete', function() {
				$('#form')[0].submit();
			});

			$('#uploader').plupload('start');
		} else {
			alert("You must have at least one file in the queue.");
		}
		return false; // Keep the form from submitting
	});




</script>

    <div id="metaform">
    <div id="metaform-background">&nbsp;</div>
    <div id="metaform-form">
        <div class="mediatum_metaform_div"><a href="#" onclick="closeMetaForm()" i18n:attributes="title mask_editor_cancel"><img src="/img/cancel.png"/></a></div>
        <form id="metaformcontent"> </form>
    </div>
    </div>

    <script tal:content="python:u'var js_edit_layout_togglertip_open = \'{}\';'.format(t(language, 'edit_layout_togglertip_open'))">;</script>
    <script tal:content="python:u'var js_edit_layout_togglertip_closed = \'{}\';'.format(t(language, 'edit_layout_togglertip_closed'))">;</script>
    <script tal:content="python:u'var north_size = {};'.format(navigation_height + 30)"/>

    <script>
        $(document).ready(function () {
            showDebugMessages: true;
            sublayout = $('#sub_content').layout({applyDemoStyles: true,
                center:{paneSelector: "#sub_content_content",},
                north:{paneSelector: "#navigation_content", size:north_size,resizable:false,},
                south:{paneSelector: "#sub_footer_module",size:20,closable:false, resizable:false, spacing_open: 0, spacing_closed: 0,},

                togglerTip_open: js_edit_layout_togglertip_open,
                togglerTip_closed: js_edit_layout_togglertip_closed,

                });

        });
    </script>


</tal:block>

<tal:block metal:define-macro="addmeta">
    <script>

        function showOrHide(selector, selectedIndex){
            if (selectedIndex == 0) {
                $(selector).hide();
            }
            else {
                $(selector).show();
            }
        }


        function createMetaObject(){

            parent.$('#overlay').css('display', 'none');

            var ajax_response;

            var options = {
                  url: '/edit/edit_content?action=createobject&func=createMetaObject&contenttype='+$('#schema').val().split('|')[1]+'&schema='+$('#schema').val().split('|')[0]+'&id='+id,
                  async: false,
                  dataType: 'json',
                  success: function(data){
                      ajax_response = data;
                      $('#metaform').hide();
                      document.location = '/edit/edit_content?id='+data.newid+'&func=createMetaObject&tab=metadata'
                  }
                };

            $.ajax(options);
            updateNodeLabels("");
        }

        function disenableInput(index) {
          if (index != 0) {
            $("#input_identifier").prop('disabled', false);
            $('#identifier_subform').show();
          }
          else {
            $("#input_identifier").prop('disabled', true);
            $('#identifier_subform').hide();
          }
        }


    </script>
    <h3 i18n:translate="edit_upload_create_meta">TEXT</h3>

    <!-- create object via metadata scheme -->
    <div id="subform_meta">

      <p><tal:block i18n:translate="edit_upload_scheme"/><br/>
          <select name="schema" id="schema" onchange="showOrHide('#buttoncreate2', this.selectedIndex);">
              <option i18n:translate="edit_upload_schemeselection">TEXT</option>
              <tal:block tal:repeat="scheme schemes">
                  <option tal:attributes="value python:scheme['id']+'|'+scheme['datatype']; title python:scheme['description']" tal:content="python:scheme['name']"/>
              </tal:block>
          </select>
      </p>
      <p class="mediatum_edit_upload_scheme_text">
          <button type="button" id="buttoncreate2" onclick="createMetaObject()" i18n:translate="edit_upload_create_object">TEXT</button>
      </p>
    </div>

</tal:block>


<tal:block metal:define-macro="adddoi">
    <script>

        function createObjectFromIdentifier(){

            var ajax_response;

            var options = {
                  url: '/edit/edit_content?action=obj_from_identifier&func=createObjectFromIdentifier&identifier_importer='+$('#identifier_importer').val()+'&identifier='+$('#input_identifier').val()+'&id='+id,
                  async: false,
                  dataType: 'json',
                  success: function(data){
                      ajax_response = data;

                      if (data.error != '') {
                        var msg = data.error;
                        if (data.error_detail != '') {
                        msg = msg + '\n' + data.error_detail;
                        }
                        alert(msg);
                      }
                      else {
                        $('#metaform').hide();
                        updateNodeLabels("");
                        parent.$('#overlay').css('display', 'none');
                        if (false && typeof data.newid !== 'undefined') {
                          document.location = '/edit/edit_content?id='+data.newid+'&func=createObjectFromIdentifier&tab=metadata'  // open newly created node in metadata editor
                        }
                        else
                        {
                          document.location = '/edit/edit_content?id='+id+'&func=createObjectFromIdentifier'; // show content of upload container
                        }
                      }
                  }
                };
              $.ajax(options);
        }


    </script>
    <h3 i18n:translate="edit_upload_create_meta">TEXT</h3>

    <!-- create object from identifier (doi, ...) -->
    <div class="mediatum_subform_identifier">
      <div tal:condition="python:len(identifier_importers)>1">
          <tal:block i18n:translate="edit_upload_importer_sel"/><br/>
          <select name="identifier_importer" id="identifier_importer" onchange="disenableInput(this.selectedIndex)">
              <option value="-1" i18n:translate="edit_upload_importerselection">TEXT</option>
              <tal:block tal:repeat="identifier_importer identifier_importers">
                  <option i18n:translate="" tal:attributes="value python:identifier_importer.name" tal:content="python:identifier_importer.get('labels', {}).get(language, {}).get('identifier_importer_longname', 'identifier_importer_longname')"/>
              </tal:block>
          </select>
          <div id="identifier_subform">
          <p tal:content="structure python:identifier_importers[0].get('labels', {}).get(language, {}).get('identifier_importer_explain', 'identifier_importer_explain')">TEXT</p>
          <div class="label"><tal:block i18n:translate="edit_upload_or_doi">TEXT</tal:block>:</div>
          <input id="input_identifier" type="text" name="input_identifier" disabled/>
          <p class="mediatum_subform_identifier_text">
              <button type="button" class="mediatum_buttoncreate3" onclick="createObjectFromIdentifier()" i18n:translate="edit_upload_create_object">TEXT</button>
          </p>
          </div>
      </div>

      <div tal:condition="python:len(identifier_importers)==1">
          <p tal:content="structure python:identifier_importers[0].get('labels', {}).get(language, {}).get('identifier_importer_explain', 'identifier_importer_explain')">TEXT</p>
          <input type="hidden" name="identifier_importer" id="identifier_importer" tal:attributes="value python:identifier_importers[0].name"/>
          <input id="input_identifier" type="text" name="input_identifier" />
          <input id="dummy" type="text" name="" disabled/>
          <p class="mediatum_subform_identifier_text">
              <button type="button" class="mediatum_buttoncreate3" onclick="createObjectFromIdentifier()" i18n:translate="edit_upload_create_object">TEXT</button>
          </p>
      </div>

    </div>

</tal:block>

<tal:block metal:define-macro="uploadfileok_plupload">
    <div class="schema" tal:define="type python:schemes.keys()[0]"> <span i18n:translate="edit_upload_select_metadata_type">Select metadata type: </span>
        <select class="typesel" tal:attributes="name python:u'scheme_{}'.format(filename); id type" tal:condition="python:len(schemes[type])>1">
            <tal:block tal:repeat="scheme python:schemes[type]">
                <option tal:attributes="value python:scheme.name" tal:content="python:scheme.getLongName()">TEXT</option>
            </tal:block>
        </select>
        <tal:block tal:condition="python:len(schemes[type])==1" tal:replace="python:schemes[type][0].getLongName()"/>
        <input type="hidden" tal:condition="python:len(schemes[type])==1" name="scheme" class="typesel" tal:attributes="id type; value python:schemes[type][0].name"/>
        <input type="hidden" tal:attributes="value python:'|'.join(files);id type"/>
    </div>
</tal:block>

<tal:block metal:define-macro="uploadzipfileok_plupload">
    <div class="schema" style="overflow:hidden;z-index:0">
        <div class="selection mediatum_uploadzipfileok_plupload">
        <tal:block tal:repeat="type python:schemes.keys()">
            <tal:block tal:content="type"/>
            <select name="scheme" class="typesel" tal:attributes="id type" tal:condition="python:len(schemes[type])>1">
                <tal:block tal:repeat="scheme python:schemes[type]">
                    <option tal:attributes="value python:scheme.name" tal:content="python:scheme.name">TEXT</option>
                </tal:block>
            </select>
            <tal:block tal:condition="python:len(schemes[type])==1" tal:replace="python:schemes[type][0].getLongName()"/>
            <input type="hidden" tal:condition="python:len(schemes[type])==1" class="typesel" name="scheme"
            tal:attributes="id type; value python:schemes[type][0].name"/>
            <br/>
            <input type="hidden" tal:attributes="value python:'|'.join(files);id type"/>
        </tal:block>
        </div>
        <div class="mediatum_uploadzipfileok">
            <tal:block tal:repeat="file files">
                <tal:block tal:content="file">TEXT</tal:block><br/>
            </tal:block>
        </div>
    </div>
</tal:block>

<tal:block metal:define-macro="uploadbibfileok_plupload">
    <div class="schema error" tal:condition="python:error!=''" i18n:translate="" tal:content="python:u'upload_{}'.format(error)">TEXT</div>
    <tal:block tal:condition="python:error==''">
        <div i18n:translate="edit_upload_bibtex_ok">TEXT</div>
        <input type="hidden" class="typesel" name="scheme" id="bibtex" value="bibtex"/>
        <input type="hidden" id="bibtex" tal:attributes="value python:'|'.join(files)"/>
    </tal:block>
</tal:block>

<tal:block metal:define-macro="uploadfileok">
    <div class="mediatum_uploadmsg">
        <a href="#" onclick="return removeItem(this)"><img src="/img/delete.png" /></a>
    </div>
    <div class="schema" tal:define="type python:schemes.keys()[0]">
        <select name="scheme" class="typesel" tal:attributes="id type" tal:condition="python:len(schemes[type])>1">
            <tal:block tal:repeat="scheme python:schemes[type]">
                <option tal:attributes="value python:scheme.name" tal:content="python:scheme.name">TEXT</option>
            </tal:block>
        </select>
        <tal:block tal:condition="python:len(schemes[type])==1" tal:replace="python:schemes[type][0].getLongName()"/>
        <input type="hidden" tal:condition="python:len(schemes[type])==1" name="scheme" class="typesel" tal:attributes="id type; value python:schemes[type][0].name"/>
        <input type="hidden" tal:attributes="value python:'|'.join(files);id type"/>
    </div>
</tal:block>

<tal:block metal:define-macro="uploadzipfileok">
    <div class="mediatum_uploadmsg">
        <a href="#" onclick="return removeItem(this)"><img src="/img/delete.png" /></a>
    </div>
    <div class="schema" style="overflow:hidden;z-index:0">
        <div class="selection" style="background-color:white;z-index:3">
        <tal:block tal:repeat="type python:schemes.keys()">
            <tal:block tal:content="type"/>
            <select name="scheme" class="typesel" tal:attributes="id type" tal:condition="python:len(schemes[type])>1">
                <tal:block tal:repeat="scheme python:schemes[type]">
                    <option tal:attributes="value python:scheme.name" tal:content="python:scheme.name">TEXT</option>
                </tal:block>
            </select>
            <tal:block tal:condition="python:len(schemes[type])==1" tal:replace="python:schemes[type][0].getLongName()"/>
            <input type="hidden" tal:condition="python:len(schemes[type])==1" class="typesel" name="scheme" tal:attributes="id type; value python:schemes[type][0].name"/>
            <br/>
            <input type="hidden" tal:attributes="value python:'|'.join(files);id type"/>
        </tal:block>
        </div>
        <div class="mediatum_uploadzipfileok">
            <tal:block tal:repeat="file files">
                <tal:block tal:content="file">TEXT</tal:block><br/>
            </tal:block>
        </div>
    </div>
</tal:block>

<tal:block metal:define-macro="uploadbibfileok">
    <div class="mediatum_uploadmsg">
        <a href="#" onclick="return removeItem(this)"><img src="/img/delete.png" /></a>
    </div>
    <div class="schema error" tal:condition="python:error!=''" i18n:translate="" tal:content="python:u'upload_{}'.format(error)">TEXT</div>
    <tal:block tal:condition="python:error==''">
        <div i18n:translate="edit_upload_bibtex_ok">TEXT</div>
        <input type="hidden" class="typesel" name="scheme" id="bibtex" value="bibtex"/>
        <input type="hidden" id="bibtex" tal:attributes="value python:'|'.join(files)"/>
    </tal:block>
</tal:block>

<tal:block metal:define-macro="uploadfileerror">
    <div class="mediatum_uploadmsg">
        <a href="#" onclick="return removeItem(this)"><img src="/img/delete.png" /></a>
    </div>
    <div class="schema error">Dateityp wird nicht unterst√ºtzt oder Sie besitzen keine Berechtigung.</div>
</tal:block>
