<tal:block metal:define-macro="create_version">
    <link rel="stylesheet" href="/static/css/edit/modules/version.css" type="text/css" />

    <script tal:content="python:u'var js_edit_layout_togglertip_open = \'{}\';'.format(translate(language, 'edit_layout_togglertip_open'))"/>
    <script tal:content="python:u'var js_edit_layout_togglertip_closed = \'{}\';'.format(translate(language, 'edit_layout_togglertip_closed'))"/>
    <script src="/static/js/jquery.layout.min.js"> </script>
    <script src="/static/js/jquery.layout.resizePaneAccordions-latest.min.js"> </script>
    <script src="/static/js/edit/modules/version.js"> </script>

    <div id="navigation_content">

        <tal:block metal:use-macro="web/edit/edit.html/itemlist"/>

        <div id="operation">
            <form class="edit" action="edit_content" method="post" id="changeform">
                <input tal:attributes="value csrf" type="hidden" name="csrf_token">
                <input type="hidden" name="tab" value="version">
                <input tal:attributes="value idstr" type="hidden" name="id">
                <input tal:attributes="value srcnodeid" type="hidden" name="srcnodeid">
            </form>
        </div>
    </div>

    <div id="sub_content_content">

        <!--<div id="scrollcontent">-->
            <form class="edit" action="edit_content" method="post" id="myform">
                <input tal:attributes="value csrf" type="hidden" name="csrf_token">
                <input tal:attributes="value srcnodeid" type="hidden" name="srcnodeid">
                <div class="label">&nbsp;</div>
                <br/>
                <br/>
                <div class="label">&nbsp;</div>
                <br/>
                <br/>

        <tal:block tal:condition="python:node.type not in ['collection', 'collections', 'directory'] and node.has_write_access()">
        <div class="editorrow">
            <div class="label"><tal:block i18n:translate="create_version_information"/></div>
            <div id="div_description">&nbsp;</div>
            <div id="editor_content">&nbsp;</div>
        </div>
        <br/>
        <div class="editorrow">
            <div class="label"><tal:block i18n:translate="create_version_generate_new_version"/></div>
            <div id="div_description">&nbsp;</div>
            <div id="editor_content">
                <input type="checkbox" name="generate_new_version" onchange="onNewVersionChecked(this);return false;" />
            </div>
        </div>
        <div class="editorrow" id="version_comment">
            <div class="label"><tal:block i18n:translate="create_version_comment"/>:<span class="required">*</span></div>
            <div id="div_description">&nbsp;</div>
            <div id="editor_content">
                <textarea name="version_comment" rows="4" tal:content="python:''"> </textarea>
            </div>
        </div>
        <div class="editorrow">
            <div class="label">&nbsp;</div>
            <div id="div_description">&nbsp;</div>
            <div id="editor_content">
                <table class="version-list" width="380" cellspacing="1" cellpadding="5">
                    <tr>
                        <th><tal:block i18n:translate="create_version_version"/></th>
                        <th><tal:block i18n:translate="create_version_timestamp_comment"/></th>
                        <th><tal:block i18n:translate="create_version_updateduser"/></th>
                    </tr>
                    <tr tal:condition="python: untagged_current_version" class="row active">
						<td><a tal:attributes="href python:node_url(untagged_current_version.id)"
						       i18n:translate="untagged_version"
						       target="frontend">untagged</a>
						</td>
                        <td>
                        <div tal:content="python:untagged_current_version.pretty_format_update_time"></div>
                        </td>
                        <td>
                        <div tal:content="python:untagged_current_version.updateuser"></div>
                        </td>
                    </tr>
                    <tal:block tal:repeat="v tagged_versions">
                    <tr tal:attributes="class python:(v.isActiveVersion() and 'row active' or 'row') ">
                      <td><a href="/" tal:attributes="href python:node_url(v.id, v.tag)" target="frontend"
                             tal:content="python:v.tag">Version</a></td>
                        <td>
                        <div tal:content="python:v.pretty_format_update_time"></div>
                        <div tal:content="python:v.comment"></div>
                        </td>
                        <td>
                        <div tal:content="python:v.updateuser"></div>
                        </td>
                    </tr>
                    </tal:block>
                    <tr tal:condition="python: published_version" class="row active">
						<td><a tal:attributes="href python:node_url(published_version.id, 'published')"
						       i18n:translate="published_version"
						       target="frontend">untagged</a>
						</td>
                        <td>
                        <div tal:content="python:published_version.pretty_format_update_time"></div>
                        </td>
                        <td>
                        <div tal:content="python:published_version.updateuser"></div>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        </tal:block>
        <br/>
        <br/>
                <br/>
                <div class="label">&nbsp;</div>
                <input id="save_button" disabled="disabled" i18n:attributes="value create_version_save" type="submit" name="save"/>
                <br/>
                <br/>
                <br/>
                <input type="hidden" name="tab" value="version"/>
                <input tal:attributes="value idstr" type="hidden" name="id"/>
                <input type="hidden" name="nodename_changed" value="nodename_changed"/>
                <br/>
                <br/>
            </form>
        <!--</div>-->
    </div>
    <div id="sub_footer_module">
        <div>
            <small>
            </small>
        </div>
    </div>
</tal:block>
